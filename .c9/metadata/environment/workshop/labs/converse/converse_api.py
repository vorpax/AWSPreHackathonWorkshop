{"filter":false,"title":"converse_api.py","tooltip":"/workshop/labs/converse/converse_api.py","ace":{"folds":[],"scrolltop":1306,"scrollleft":0,"selection":{"start":{"row":101,"column":0},"end":{"row":101,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"hash":"6510ef9c8451be30070f9096dfe282df96315ab4","undoManager":{"mark":8,"position":8,"stack":[[{"start":{"row":0,"column":0},"end":{"row":29,"column":0},"action":"insert","lines":["import boto3, json","","print(\"\\n----A basic call to the Converse API----\\n\")","","session = boto3.Session()","bedrock = session.client(service_name='bedrock-runtime')","","message_list = []","","initial_message = {","    \"role\": \"user\",","    \"content\": [","        { \"text\": \"How are you today?\" } ","    ],","}","","message_list.append(initial_message)","","response = bedrock.converse(","    modelId=\"anthropic.claude-3-sonnet-20240229-v1:0\",","    messages=message_list,","    inferenceConfig={","        \"maxTokens\": 2000,","        \"temperature\": 0","    },",")","","response_message = response['output']['message']","print(json.dumps(response_message, indent=4))",""],"id":1}],[{"start":{"row":29,"column":0},"end":{"row":30,"column":0},"action":"insert","lines":["",""],"id":2},{"start":{"row":30,"column":0},"end":{"row":31,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":31,"column":0},"end":{"row":67,"column":0},"action":"insert","lines":["print(\"\\n----Including an image in a message----\\n\")","","with open(\"image.webp\", \"rb\") as image_file:","    image_bytes = image_file.read()","","image_message = {","    \"role\": \"user\",","    \"content\": [","        { \"text\": \"Image 1:\" },","        {","            \"image\": {","                \"format\": \"webp\",","                \"source\": {","                    \"bytes\": image_bytes #no base64 encoding required!","                }","            }","        },","        { \"text\": \"Please describe the image.\" }","    ],","}","","message_list.append(image_message)","","response = bedrock.converse(","    modelId=\"anthropic.claude-3-sonnet-20240229-v1:0\",","    messages=message_list,","    inferenceConfig={","        \"maxTokens\": 2000,","        \"temperature\": 0","    },",")","","response_message = response['output']['message']","print(json.dumps(response_message, indent=4))","","message_list.append(response_message)",""],"id":3}],[{"start":{"row":9,"column":0},"end":{"row":9,"column":2},"action":"insert","lines":["# "],"id":4},{"start":{"row":10,"column":0},"end":{"row":10,"column":2},"action":"insert","lines":["# "]},{"start":{"row":11,"column":0},"end":{"row":11,"column":2},"action":"insert","lines":["# "]},{"start":{"row":12,"column":0},"end":{"row":12,"column":2},"action":"insert","lines":["# "]},{"start":{"row":13,"column":0},"end":{"row":13,"column":2},"action":"insert","lines":["# "]},{"start":{"row":14,"column":0},"end":{"row":14,"column":2},"action":"insert","lines":["# "]},{"start":{"row":16,"column":0},"end":{"row":16,"column":2},"action":"insert","lines":["# "]},{"start":{"row":18,"column":0},"end":{"row":18,"column":2},"action":"insert","lines":["# "]},{"start":{"row":19,"column":0},"end":{"row":19,"column":2},"action":"insert","lines":["# "]},{"start":{"row":20,"column":0},"end":{"row":20,"column":2},"action":"insert","lines":["# "]},{"start":{"row":21,"column":0},"end":{"row":21,"column":2},"action":"insert","lines":["# "]},{"start":{"row":22,"column":0},"end":{"row":22,"column":2},"action":"insert","lines":["# "]},{"start":{"row":23,"column":0},"end":{"row":23,"column":2},"action":"insert","lines":["# "]},{"start":{"row":24,"column":0},"end":{"row":24,"column":2},"action":"insert","lines":["# "]},{"start":{"row":25,"column":0},"end":{"row":25,"column":2},"action":"insert","lines":["# "]},{"start":{"row":27,"column":0},"end":{"row":27,"column":2},"action":"insert","lines":["# "]},{"start":{"row":28,"column":0},"end":{"row":28,"column":2},"action":"insert","lines":["# "]}],[{"start":{"row":33,"column":11},"end":{"row":33,"column":12},"action":"insert","lines":["."],"id":5},{"start":{"row":33,"column":12},"end":{"row":33,"column":13},"action":"insert","lines":["/"]}],[{"start":{"row":67,"column":0},"end":{"row":68,"column":0},"action":"insert","lines":["",""],"id":6},{"start":{"row":68,"column":0},"end":{"row":69,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":67,"column":0},"end":{"row":68,"column":0},"action":"insert","lines":["",""],"id":7},{"start":{"row":68,"column":0},"end":{"row":69,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":68,"column":0},"end":{"row":95,"column":0},"action":"insert","lines":["print(\"\\n----Setting a system prompt----\\n\")","","summary_message = {","    \"role\": \"user\",","    \"content\": [","        { \"text\": \"Can you please summarize our conversation so far?\" } ","    ],","}","","message_list.append(summary_message)","","response = bedrock.converse(","    modelId=\"anthropic.claude-3-sonnet-20240229-v1:0\",","    messages=message_list,","    system=[","        { \"text\": \"Please respond to all requests in the style of a pirate.\" }","    ],","    inferenceConfig={","        \"maxTokens\": 2000,","        \"temperature\": 0","    },",")","","response_message = response['output']['message']","print(json.dumps(response_message, indent=4))","","message_list.append(response_message)",""],"id":8}],[{"start":{"row":96,"column":0},"end":{"row":100,"column":0},"action":"insert","lines":["print(\"\\n----Getting response metadata and token counts----\\n\")","","print(\"Stop Reason:\", response['stopReason'])","print(\"Usage:\", json.dumps(response['usage'], indent=4))",""],"id":9}]]},"timestamp":1737046594917}