{"filter":false,"title":"embeddings_search_lib.py","tooltip":"/workshop/labs/embeddings_search/embeddings_search_lib.py","undoManager":{"mark":8,"position":8,"stack":[[{"start":{"row":0,"column":0},"end":{"row":4,"column":0},"action":"insert","lines":["import itertools","import boto3","import chromadb","from chromadb.utils.embedding_functions import AmazonBedrockEmbeddingFunction",""],"id":8}],[{"start":{"row":4,"column":0},"end":{"row":5,"column":0},"action":"insert","lines":["",""],"id":9}],[{"start":{"row":5,"column":0},"end":{"row":13,"column":0},"action":"insert","lines":["def get_collection(path, collection_name):","    session = boto3.Session()","    embedding_function = AmazonBedrockEmbeddingFunction(session=session, model_name=\"amazon.titan-embed-text-v2:0\")","    ","    client = chromadb.PersistentClient(path=path)","    collection = client.get_collection(collection_name, embedding_function=embedding_function)","    ","    return collection",""],"id":10}],[{"start":{"row":12,"column":21},"end":{"row":13,"column":0},"action":"insert","lines":["",""],"id":11},{"start":{"row":13,"column":0},"end":{"row":13,"column":4},"action":"insert","lines":["    "]},{"start":{"row":13,"column":4},"end":{"row":14,"column":0},"action":"insert","lines":["",""]},{"start":{"row":14,"column":0},"end":{"row":14,"column":4},"action":"insert","lines":["    "]},{"start":{"row":14,"column":4},"end":{"row":15,"column":0},"action":"insert","lines":["",""]},{"start":{"row":15,"column":0},"end":{"row":15,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":15,"column":0},"end":{"row":15,"column":4},"action":"remove","lines":["    "],"id":12},{"start":{"row":14,"column":4},"end":{"row":15,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":14,"column":4},"end":{"row":15,"column":0},"action":"insert","lines":["",""],"id":13},{"start":{"row":15,"column":0},"end":{"row":15,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":15,"column":0},"end":{"row":15,"column":4},"action":"remove","lines":["    "],"id":14}],[{"start":{"row":15,"column":0},"end":{"row":23,"column":0},"action":"insert","lines":["def get_vector_search_results(collection, question):","    ","    results = collection.query(","        query_texts=[question],","        n_results=4","    )","    ","    return results",""],"id":15}],[{"start":{"row":24,"column":0},"end":{"row":36,"column":0},"action":"insert","lines":["def get_similarity_search_results(question):","","    session = boto3.Session()","    bedrock = session.client(service_name='bedrock-runtime')","    ","    collection = get_collection(\"../../data/chroma\", \"bedrock_faqs_collection\")","    ","    search_results = get_vector_search_results(collection, question)","    ","    flattened_results_list = list(itertools.chain(*search_results['documents'])) #flatten the list of lists returned by chromadb","    ","    return flattened_results_list",""],"id":17}]]},"ace":{"folds":[],"scrolltop":424,"scrollleft":0,"selection":{"start":{"row":36,"column":0},"end":{"row":36,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1737190305455,"hash":"ade6b4c19ac71bc8edacfb0871b4771e61bb2184"}