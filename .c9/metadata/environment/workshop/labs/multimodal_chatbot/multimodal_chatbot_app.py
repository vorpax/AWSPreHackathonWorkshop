{"filter":false,"title":"multimodal_chatbot_app.py","tooltip":"/workshop/labs/multimodal_chatbot/multimodal_chatbot_app.py","undoManager":{"mark":10,"position":10,"stack":[[{"start":{"row":0,"column":0},"end":{"row":2,"column":0},"action":"insert","lines":["import streamlit as st #all streamlit commands will be available through the \"st\" alias","import multimodal_chatbot_lib as glib #reference to local lib script",""],"id":11}],[{"start":{"row":2,"column":0},"end":{"row":3,"column":0},"action":"insert","lines":["",""],"id":12},{"start":{"row":3,"column":0},"end":{"row":4,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":4,"column":0},"end":{"row":6,"column":0},"action":"insert","lines":["st.set_page_config(page_title=\"Multimodal Chatbot\") #HTML title","st.title(\"Multimodal Chatbot\") #page title",""],"id":13}],[{"start":{"row":6,"column":0},"end":{"row":7,"column":0},"action":"insert","lines":["",""],"id":14},{"start":{"row":7,"column":0},"end":{"row":8,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":8,"column":0},"end":{"row":10,"column":0},"action":"insert","lines":["if 'chat_history' not in st.session_state: #see if the chat history hasn't been created yet","    st.session_state.chat_history = [] #initialize the chat history",""],"id":15}],[{"start":{"row":10,"column":0},"end":{"row":11,"column":0},"action":"insert","lines":["",""],"id":16},{"start":{"row":11,"column":0},"end":{"row":12,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":12,"column":0},"end":{"row":28,"column":0},"action":"insert","lines":["chat_container = st.container()","","input_text = st.chat_input(\"Chat with your bot here\") #display a chat input box","","uploaded_file = st.file_uploader(\"Select an image\", type=['png', 'jpg'], label_visibility=\"collapsed\")","","","col1, col2, col3 = st.columns(3)","with col1:","    upload_image_1 = st.button(\"Add miniature house image\")","","with col2:","    upload_image_2 = st.button(\"Add house and car image\")","","with col3:","    upload_image_3 = st.button(\"Add miniature car image\")",""],"id":17}],[{"start":{"row":28,"column":0},"end":{"row":29,"column":0},"action":"insert","lines":["",""],"id":18},{"start":{"row":29,"column":0},"end":{"row":30,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":30,"column":0},"end":{"row":49,"column":0},"action":"insert","lines":["if upload_image_1:","    image_bytes = glib.get_bytes_from_file(\"images/minihouse.jpg\")","    glib.chat_with_model(message_history=st.session_state.chat_history, new_text=None, new_image_bytes=image_bytes)","    ","elif upload_image_2:","    image_bytes = glib.get_bytes_from_file(\"images/house_and_car.jpg\")","    glib.chat_with_model(message_history=st.session_state.chat_history, new_text=None, new_image_bytes=image_bytes)","","elif upload_image_3:","    image_bytes = glib.get_bytes_from_file(\"images/minicar.jpg\")","    glib.chat_with_model(message_history=st.session_state.chat_history, new_text=None, new_image_bytes=image_bytes)","","elif input_text: #run the code in this if block after the user submits a chat message","    glib.chat_with_model(message_history=st.session_state.chat_history, new_text=input_text, new_image_bytes=None)","","elif uploaded_file:","    image_bytes = uploaded_file.getvalue()","    ","    glib.chat_with_model(message_history=st.session_state.chat_history, new_text=None, new_image_bytes=image_bytes)",""],"id":19}],[{"start":{"row":49,"column":0},"end":{"row":50,"column":0},"action":"insert","lines":["",""],"id":20}],[{"start":{"row":50,"column":0},"end":{"row":57,"column":0},"action":"insert","lines":["#Re-render the chat history (Streamlit re-runs this script, so need this to preserve previous chat messages)","for message in st.session_state.chat_history: #loop through the chat history","    with chat_container.chat_message(message.role): #renders a chat line for the given role, containing everything in the with block","        if (message.message_type == 'image'):","            st.image(message.bytesio)","        else:","            st.markdown(message.text) #display the chat content",""],"id":21}]]},"ace":{"folds":[],"scrolltop":535,"scrollleft":0,"selection":{"start":{"row":56,"column":29},"end":{"row":56,"column":29},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":37,"state":"start","mode":"ace/mode/python"}},"timestamp":1737200679526,"hash":"2dd45759031ff4075c7dc736eff1c2b418b6c776"}